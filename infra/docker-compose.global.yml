# ═══════════════════════════════════════════════════════════════════════════════
# VANTAGE-STR — Global Network Docker Compose
# Auto-generated by deploy_global.py
# ═══════════════════════════════════════════════════════════════════════════════

version: "3.9"

networks:
  vantage-global:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16

services:
  # ── Global Orchestrator ──
  orchestrator:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: vantage-orchestrator
    ports:
      - "8000:8000"
    environment:
      - VANTAGE_ROLE=orchestrator
      - VANTAGE_MTLS_CA=/certs/ca.crt
      - VANTAGE_MTLS_CERT=/certs/orchestrator.crt
      - VANTAGE_MTLS_KEY=/certs/orchestrator.key
    volumes:
      - ../infra/certs:/certs:ro
    networks:
      vantage-global:
        ipv4_address: 172.28.0.2
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 3


  # ── Node: bka-de (Germany, Frankfurt) ──
  bka-de:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: vantage-bka-de
    ports:
      - "8102:8000"
    environment:
      - VANTAGE_ROLE=node
      - VANTAGE_NODE_ID=bka-de
      - VANTAGE_COUNTRY=DE
      - VANTAGE_CITY=Frankfurt
      - VANTAGE_ORCHESTRATOR_URL=http://172.28.0.2:8000
      - VANTAGE_SYNTHETIC_PROFILES=150
      - VANTAGE_MTLS_CA=/certs/ca.crt
      - VANTAGE_MTLS_CERT=/certs/bka-de.crt
      - VANTAGE_MTLS_KEY=/certs/bka-de.key
      - VANTAGE_ZKP_ENABLED=true
      - VANTAGE_DSPY_ENABLED=true
    volumes:
      - ../infra/certs:/certs:ro
    depends_on:
      orchestrator:
        condition: service_healthy
    networks:
      vantage-global:
        ipv4_address: 172.28.0.10
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 3

  # ── Node: fbi-us (USA, Washington) ──
  fbi-us:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: vantage-fbi-us
    ports:
      - "8104:8000"
    environment:
      - VANTAGE_ROLE=node
      - VANTAGE_NODE_ID=fbi-us
      - VANTAGE_COUNTRY=US
      - VANTAGE_CITY=Washington
      - VANTAGE_ORCHESTRATOR_URL=http://172.28.0.2:8000
      - VANTAGE_SYNTHETIC_PROFILES=200
      - VANTAGE_MTLS_CA=/certs/ca.crt
      - VANTAGE_MTLS_CERT=/certs/fbi-us.crt
      - VANTAGE_MTLS_KEY=/certs/fbi-us.key
      - VANTAGE_ZKP_ENABLED=true
      - VANTAGE_DSPY_ENABLED=true
    volumes:
      - ../infra/certs:/certs:ro
    depends_on:
      orchestrator:
        condition: service_healthy
    networks:
      vantage-global:
        ipv4_address: 172.28.0.11
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 3

  # ── Node: jandarma-tr (Turkey, Istanbul) ──
  jandarma-tr:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: vantage-jandarma-tr
    ports:
      - "8101:8000"
    environment:
      - VANTAGE_ROLE=node
      - VANTAGE_NODE_ID=jandarma-tr
      - VANTAGE_COUNTRY=TR
      - VANTAGE_CITY=Istanbul
      - VANTAGE_ORCHESTRATOR_URL=http://172.28.0.2:8000
      - VANTAGE_SYNTHETIC_PROFILES=100
      - VANTAGE_MTLS_CA=/certs/ca.crt
      - VANTAGE_MTLS_CERT=/certs/jandarma-tr.crt
      - VANTAGE_MTLS_KEY=/certs/jandarma-tr.key
      - VANTAGE_ZKP_ENABLED=true
      - VANTAGE_DSPY_ENABLED=true
    volumes:
      - ../infra/certs:/certs:ro
    depends_on:
      orchestrator:
        condition: service_healthy
    networks:
      vantage-global:
        ipv4_address: 172.28.0.12
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 3

  # ── Node: npa-jp (Japan, Tokyo) ──
  npa-jp:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: vantage-npa-jp
    ports:
      - "8103:8000"
    environment:
      - VANTAGE_ROLE=node
      - VANTAGE_NODE_ID=npa-jp
      - VANTAGE_COUNTRY=JP
      - VANTAGE_CITY=Tokyo
      - VANTAGE_ORCHESTRATOR_URL=http://172.28.0.2:8000
      - VANTAGE_SYNTHETIC_PROFILES=80
      - VANTAGE_MTLS_CA=/certs/ca.crt
      - VANTAGE_MTLS_CERT=/certs/npa-jp.crt
      - VANTAGE_MTLS_KEY=/certs/npa-jp.key
      - VANTAGE_ZKP_ENABLED=true
      - VANTAGE_DSPY_ENABLED=true
    volumes:
      - ../infra/certs:/certs:ro
    depends_on:
      orchestrator:
        condition: service_healthy
    networks:
      vantage-global:
        ipv4_address: 172.28.0.13
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 3

  # ── Node: pf-br (Brazil, Brasilia) ──
  pf-br:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: vantage-pf-br
    ports:
      - "8105:8000"
    environment:
      - VANTAGE_ROLE=node
      - VANTAGE_NODE_ID=pf-br
      - VANTAGE_COUNTRY=BR
      - VANTAGE_CITY=Brasilia
      - VANTAGE_ORCHESTRATOR_URL=http://172.28.0.2:8000
      - VANTAGE_SYNTHETIC_PROFILES=120
      - VANTAGE_MTLS_CA=/certs/ca.crt
      - VANTAGE_MTLS_CERT=/certs/pf-br.crt
      - VANTAGE_MTLS_KEY=/certs/pf-br.key
      - VANTAGE_ZKP_ENABLED=true
      - VANTAGE_DSPY_ENABLED=true
    volumes:
      - ../infra/certs:/certs:ro
    depends_on:
      orchestrator:
        condition: service_healthy
    networks:
      vantage-global:
        ipv4_address: 172.28.0.14
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 3

